/*
STORE PROCEDURE

-- CENTRALIZA TODA TODA REGRA DE NEGOCIO TAIS COMO
	--SELECT, UPDATE, DELETE, INSERT
-- DEIXA SEU BANCO MAIS RAPIDO...

NAO CONFUNDA COM VIEWS X STORE PROCEDURE X FUNCTION

*/

-- CRIAR
GO

CREATE PROCEDURE SP_EDITORA
 AS
 SELECT * FROM TB_EDITORA;

GO
-- CHAMA

EXEC SP_EDITORA;
GO

-- ALTERAR
ALTER PROC SP_EDITORA @ID INT 
 AS
 IF @ID = ''
  BEGIN
	SELECT * FROM TB_EDITORA;
  END
 ELSE
  BEGIN
	SELECT * FROM TB_EDITORA
	WHERE COD_ED = @ID;
  END

-- CHAMA
 EXEC SP_EDITORA '';
 GO

 EXEC SP_EDITORA 1;

 -- EXLCUIR
 DROP PROC SP_EDITORA
 GO
 -- INSERIR E SELECIONAR TODOS

 CREATE PROC SP_INSERT_SELECT(
	@EDITORA VARCHAR(50)
 )
 AS
   BEGIN
	INSERT INTO TB_EDITORA(NOME_ED)
	 VALUES(@EDITORA);

	SELECT * FROM TB_EDITORA;
   END
GO

EXEC SP_INSERT_SELECT 'Person';

EXEC SP_INSERT_SELECT 'dark side';
GO

ALTER PROC SP_INSERT (
	@titulo varchar(100),
	@qtdpag smallint,
	@desc text,
	@ano date,
	@preco decimal(10,2),
	@isbn varchar(20),
	@img varchar(100),
	@qtd smallint
)
AS
DECLARE @idLiv int,
		@idEd int;
BEGIN
	INSERT INTO TB_LIVRO(
	TITULO_LIV, 
	QTPAG_LIV,
	DESC_LIV,
	ANOLAC_LIV,
	PRECO_LIV,
	ISBN_LIV,
	IMG_LIV,
	QTD_LIV)
	
	VALUES(
	@titulo,
	@qtdpag,
	@desc,
	@ano,
	@preco,
	@isbn,
	@img,
	@qtd
	);

-- MOSTRAR A ID
SELECT @idLiv = @@IDENTITY

-- EDITORA
-- INSERT

SET @idEd = @@IDENTITY

-- RELACIONAMENTO
END
GO

-- EXECUTAR

EXEC SP_INSERT
'TITULO',
12,
'DESC',
'2012-02-12',
20.00,
'121212123333',
'IMG/011.jpg',
200;
GO

